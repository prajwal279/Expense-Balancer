<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Create Group</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">


    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css">

    <script>
        function calculateAmounts() {
    var totalAmount = parseFloat(document.getElementById('total_amount').value);
    
    if (isNaN(totalAmount) || totalAmount <= 0) {
        alert("Enter a valid total amount!!!!");
        return;
    }

    var percentageInputs = document.querySelectorAll('.percentage');
    var totalPercentage = 0;
    var validPercentages = true;

    percentageInputs.forEach(function(input) {
        var percentage = parseFloat(input.value);
        var amountDisplay = input.nextElementSibling;

        if (!isNaN(percentage) && percentage > 0) {
            totalPercentage += percentage;
        } else {
            amountDisplay.textContent = "Invalid percentage";
            validPercentages = false;
        }
    });

    if (totalPercentage !== 100) {
        alert("The sum of all percentages must be equal to 100%.");
        return;
    }

    percentageInputs.forEach(function(input) {
        var percentage = parseFloat(input.value);
        var amountDisplay = input.nextElementSibling;

        if (!isNaN(percentage) && percentage > 0) {
            var amount = (totalAmount * (percentage / 100)).toFixed(2);
            amountDisplay.textContent = "Amount to pay: Rs." + amount;
        }
    });
}


        function displayAmount() {
            var totalAmount = parseFloat(document.getElementById('total_amount').value);
    
            if (isNaN(totalAmount) || totalAmount <= 0) {
                alert("Please enter a valid total amount.");
                return;
            }
            
            var inputs = document.querySelectorAll('.value');
            inputs.forEach(function(input) {
                var val = parseFloat(input.value);
                var amountDisplay = input.nextElementSibling;
                if (!isNaN(val) && val > 0) {
                    var amount = val.toFixed(2);
                    amountDisplay.textContent = "Amount to pay: Rs." + amount;
                } else {
                    amountDisplay.textContent = "Invalid value";
                }
            });
        }
        
    </script>

</head>
<body>
    {% if custom %}
    <form method="post">
        {% csrf_token %}
        <ul>
            <li>
                <strong>{{ group.name }}</strong>
                <ul>
                    {% for member in group.members.all %}
                        <li>
                            {{ member.username }}
                            <input 
                                type="text" 
                                id="total_amount"
                                class="value"
                                placeholder="Enter amount"
                            />
                            <span class="amount_display"></span>
                        </li>
                    {% endfor %}
                </ul>
            </li>
        </ul>
        <label for="total_amount">Total Amount:</label>
        <input 
            type="text" 
             
            placeholder="Enter total amount" 
        />
        <button type="button" onclick="displayAmount()">Calculate Amounts</button>
        <button type="submit">Request to pay</button>
    </form>    
</body>
</html>
{% endif %}

{% if equals %}
<form method="post">
    {% csrf_token %}
    <ul>
        <li>
            <strong>{{ group.name }}</strong>
            <ul>
                {% for member in group.members.all %}
                    <span>
                        <li>{{ member.username }}</li>
                    </span>
                    <span>
                        {{amount}}
                    </span>
                {% endfor %}
            </ul>
        </li>
    </ul>
    <button type="submit">Request to pay</button>
</form>
{% endif %}

{% if percentage %}
<form method="post">
        {% csrf_token %}
        <ul>
            <li>
                <strong>{{ group.name }}</strong>
                <ul>
                    {% for member in group.members.all %}
                        <li>
                            {{ member.username }}
                            <input 
                                type="text" 
                                class="percentage" 
                                name="percentage_{{ member.id }}" 
                                placeholder="Enter percentage"
                            />
                            <span></span>
                        </li>
                    {% endfor %}
                </ul>
            </li>
        </ul>
        <label for="total_amount">Total Amount:</label>
        <input 
            type="text" 
            id="total_amount" 
            placeholder="Enter total amount" 
        />
        <button type="button" onclick="calculateAmounts()">Calculate Amounts</button>
        <button type="submit">Request to pay</button>
    </form>
{% endif %}